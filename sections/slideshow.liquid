{% comment %} Defining schema for Shopify Theme Editor {% endcomment %}
{% schema %}
{
  "name": "Slideshow",
  "settings": [
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image 1"
    },
    {
      "type": "text",
      "id": "title_1",
      "label": "Title 1",
      "default": "Slide 1"
    },
    {
      "type": "text",
      "id": "subtitle_1",
      "label": "Subtitle 1",
      "default": "Description for slide 1"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image 2"
    },
    {
      "type": "text",
      "id": "title_2",
      "label": "Title 2",
      "default": "Slide 2"
    },
    {
      "type": "text",
      "id": "subtitle_2",
      "label": "Subtitle 2",
      "default": "Description for slide 2"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image 3"
    },
    {
      "type": "text",
      "id": "title_3",
      "label": "Title 3",
      "default": "Slide 3"
    },
    {
      "type": "text",
      "id": "subtitle_3",
      "label": "Subtitle 3",
      "default": "Description for slide 3"
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Image 4"
    },
    {
      "type": "text",
      "id": "title_4",
      "label": "Title 4",
      "default": "Slide 4"
    },
    {
      "type": "text",
      "id": "subtitle_4",
      "label": "Subtitle 4",
      "default": "Description for slide 4"
    },
    {
      "type": "image_picker",
      "id": "image_5",
      "label": "Image 5"
    },
    {
      "type": "text",
      "id": "title_5",
      "label": "Title 5",
      "default": "Slide 5"
    },
    {
      "type": "text",
      "id": "subtitle_5",
      "label": "Subtitle 5",
      "default": "Description for slide 5"
    }
  ],
  "presets": [
    {
      "name": "Slideshow",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% comment %} Styles for slideshow with zoom animation, top progress bar, and slide-in title/description {% endcomment %}
<style>
  .slideshow-container {
    min-width: 100vw;
    height: calc(100vh - 64px);
    position: relative;
    margin: auto;
    overflow: hidden;
    margin-top: 64px;
  }
  .slides-wrapper {
    display: flex;
    width: 100%;
    height: 100%;
  }
  .slide {
    flex: 0 0 100%;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    transition: opacity 0.6s ease-in-out, transform 5s ease-in-out;
  }
  .slide.active {
    opacity: 1;
    transform: scale(1.1);
  }
  .slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .slide-content {
    position: absolute;
    top: 20%;
    left: 10%;
    max-width: 40%;
    text-align: left;
    color: white;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  }
  .slide-content h2 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 15px;
    opacity: 0;
    transform: translateX(-50px);
    transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
  }
  .slide-content p {
    font-size: 1.5rem;
    font-weight: 400;
    opacity: 0;
    transform: translateX(-50px);
    transition: opacity 0.8s ease-in-out 0.2s, transform 0.8s ease-in-out 0.2s;
  }
  .slide.active .slide-content h2,
  .slide.active .slide-content p {
    opacity: 1;
    transform: translateX(0);
  }
  .progress-bar-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background-color: rgba(255, 255, 255, 0.3);
  }
  .progress-bar {
    height: 100%;
    background-color: #ff0000;
    width: 0;
    transition: width 5s linear;
  }
  .progress-bar.active {
    width: 100%;
  }
  @media screen and (max-width: 768px) {
    .slide-content {
      top: 15%;
      left: 5%;
      max-width: 90%;
      text-align: center;
    }
    .slide-content h2 {
      font-size: 2rem;
    }
    .slide-content p {
      font-size: 1rem;
    }
  }
</style>

{% comment %} Slideshow HTML structure {% endcomment %}
<div class="slideshow-container">
  <div class="slides-wrapper">
    {% if section.settings.image_1 %}
      <div class="slide">
        <img src="{{ section.settings.image_1 | img_url: 'master' }}" alt="{{ section.settings.title_1 }}">
        <div class="slide-content">
          <h2>{{ section.settings.title_1 }}</h2>
          <p>{{ section.settings.subtitle_1 }}</p>
        </div>
      </div>
    {% endif %}
    {% if section.settings.image_2 %}
      <div class="slide">
        <img src="{{ section.settings.image_2 | img_url: 'master' }}" alt="{{ section.settings.title_2 }}">
        <div class="slide-content">
          <h2>{{ section.settings.title_2 }}</h2>
          <p>{{ section.settings.subtitle_2 }}</p>
        </div>
      </div>
    {% endif %}
    {% if section.settings.image_3 %}
      <div class="slide">
        <img src="{{ section.settings.image_3 | img_url: 'master' }}" alt="{{ section.settings.title_3 }}">
        <div class="slide-content">
          <h2>{{ section.settings.title_3 }}</h2>
          <p>{{ section.settings.subtitle_3 }}</p>
        </div>
      </div>
    {% endif %}
    {% if section.settings.image_4 %}
      <div class="slide">
        <img src="{{ section.settings.image_4 | img_url: 'master' }}" alt="{{ section.settings.title_4 }}">
        <div class="slide-content">
          <h2>{{ section.settings.title_4 }}</h2>
          <p>{{ section.settings.subtitle_4 }}</p>
        </div>
      </div>
    {% endif %}
    {% if section.settings.image_5 %}
      <div class="slide">
        <img src="{{ section.settings.image_5 | img_url: 'master' }}" alt="{{ section.settings.title_5 }}">
        <div class="slide-content">
          <h2>{{ section.settings.title_5 }}</h2>
          <p>{{ section.settings.subtitle_5 }}</p>
        </div>
      </div>
    {% endif %}
  </div>
  <div class="progress-bar-container">
    <div class="progress-bar"></div>
  </div>
</div>

{% comment %} JavaScript for slideshow functionality with zoom and progress bar {% endcomment %}
<script>
  let slideIndex = 0;
  let progressInterval;

  function showSlides() {
    let slides = document.getElementsByClassName("slide");
    let progressBar = document.querySelector(".progress-bar");

    if (slideIndex >= slides.length) { slideIndex = 0 }
    if (slideIndex < 0) { slideIndex = slides.length - 1 }

    // Hide all slides and reset transform
    for (let i = 0; i < slides.length; i++) {
      slides[i].classList.remove("active");
      slides[i].style.transform = "scale(1)";
    }

    // Show current slide with zoom effect
    slides[slideIndex].classList.add("active");

    // Reset and start progress bar
    progressBar.style.width = '0';
    progressBar.classList.add("active");
  }

  function nextSlide() {
    slideIndex++;
    showSlides();
  }

  function startProgressBar() {
    clearInterval(progressInterval);
    let progressBar = document.querySelector(".progress-bar");
    progressBar.style.width = '0';
    progressBar.classList.add("active");
    progressInterval = setInterval(() => {
      nextSlide();
    }, 5000);
  }

  // Initialize slideshow
  showSlides();
  startProgressBar();
</script>